<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://microsoft.github.io/coyote/concepts/actors/logging/">
    <link rel="shortcut icon" href="/coyote/img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Logging - Coyote</title>
    <link href="/coyote/css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="/coyote/css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="/coyote/css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="/coyote/css/highlight.css">
    <link href="../../../css/main.css" rel="stylesheet">
    <link href="../../../css/player-controls.css" rel="stylesheet">
    <link href="../../../css/syntax.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="/coyote/js/jquery-3.2.1.min.js"></script>
    <script src="/coyote/js/bootstrap-3.3.7.min.js"></script>
    <script src="/coyote/js/highlight.pack.js"></script>
    <script src="https://consentdeliveryfd.azurefd.net/mscc/lib/v2/wcp-consent.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '/coyote/';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Logging", url: "#_top", children: [
          ]},
          {title: "Installing up a custom logger", url: "#installing-up-a-custom-logger", children: [
          ]},
          {title: "Adding custom actor logging consumers", url: "#adding-custom-actor-logging-consumers", children: [
          ]},
          {title: "Customizing the text formatting when logging actor activities", url: "#customizing-the-text-formatting-when-logging-actor-activities", children: [
          ]},
        ];

    </script>
    <script src="/coyote/js/base.js"></script>
      <script src="../../../assets/js/analytics.js"></script>
      <script src="../../../assets/js/plugins.js"></script>
      <script src="../../../assets/js/animate_trace.js"></script>
      <script src="../../../assets/js/animation.js"></script>
      <script src="../../../assets/js/progress_bar.js"></script>
      <script src="../../../assets/js/trace_model.js"></script>
      <script src="../../../assets/js/main.js"></script>

</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>

<div id="cookie-banner"></div>


<div class="wrapper wm-page-content">
  <div class="container-fluid">
    <a name="_top"></a>
      

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../state-machine-demo/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../state-machine-demo/" class="btn btn-xs btn-link">
        State machine demo
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../sharing-objects/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../sharing-objects/" class="btn btn-xs btn-link">
        Sharing objects
      </a>
    </div>
    
  </div>

      

      <h2 id="logging">Logging</h2>
<p>The Coyote runtime provides a <code>Microsoft.Coyote.Logging.ILogger</code> interface for logging so that your
program output can be captured and included in <code>coyote</code> test tool output logs. The installed
<code>ILogger</code> can be accessed by the <code>Logger</code> property on the <code>IActorRuntime</code> interface or the <code>Actor</code>,
<code>StateMachine</code> and <code>Monitor</code> types.</p>
<p>The default implementation of the <code>ILogger</code> writes to the console when setting the <code>--console</code>
option in the <code>coyote</code> tool (or the <code>Configuration.WithConsoleLoggingEnabled()</code> configuration when
using the <code>TestingEngine</code> API).</p>
<p>The Coyote logging infrastructure decides when to log messages using the specified <code>VerbosityLevel</code>
and the individual <code>LogSeverity</code> of messages getting logged with the <code>ILogger.Write</code> and
<code>ILogger.WriteLine</code> methods (by default the <code>LogSeverity</code> of messages is set to <code>LogSeverity.Info</code>).
As long as the <code>LogSeverity</code> is equal or higher than the <code>VerbosityLevel</code> then the message will be
logged. By default, the <code>VerbosityLevel</code> is set to <code>None</code>, which means that no messages are logged,
but this can be easily customized using the <code>--verbosity</code> (or <code>-v</code>) option in the <code>coyote</code> tool (or
the <code>Configuration.WithVerbosityEnabled()</code> configuration when using the <code>TestingEngine</code> API)</p>
<p>Setting <code>--verbosity</code> in the command line will set the <code>VerbosityLevel</code> to <code>VerbosityLevel.Info</code>
which logs all messages with <code>LogSeverity.Info</code> and higher. Other allowed verbosity values are
<code>error</code>, <code>warning</code>, <code>info</code>, <code>debug</code> and <code>exhaustive</code>. For example, choosing <code>--verbosity debug</code> will
log all messages with <code>LogSeverity.Debug</code> and higher.</p>
<h2 id="installing-up-a-custom-logger">Installing up a custom logger</h2>
<p>You can easily install your own logger by implementing the <code>ILogger</code> interface and replacing the
default logger by setting the <code>Logger</code> property on the <code>IActorRuntime</code>.</p>
<p>The following is an example of a custom <code>ILogger</code> implementation that captures all log output in a
<code>StringBuilder</code>:</p>
<pre><code class="language-csharp">using System.Text;
using Microsoft.Coyote.Logging;

class CustomLogger : ILogger
{
    private readonly StringBuilder Builder;
    private readonly VerbosityLevel VerbosityLevel;
    private readonly object Lock;

    public MemoryLogger(VerbosityLevel level)
    {
        this.Builder = new StringBuilder();
        this.VerbosityLevel = level;
        this.Lock = new object();
    }

    public void Write(string value) =&gt; this.Write(LogSeverity.Info, value);
    public void Write(string format, object arg0) =&gt;
        this.Write(LogSeverity.Info, format, arg0);
    public void Write(string format, object arg0, object arg1) =&gt;
        this.Write(LogSeverity.Info, format, arg0, arg1);
    public void Write(string format, object arg0, object arg1, object arg2) =&gt;
        this.Write(LogSeverity.Info, format, arg0, arg1, arg2);
    public void Write(string format, params object[] args) =&gt;
        this.Write(LogSeverity.Info, string.Format(format, args));

    public void Write(LogSeverity severity, string value)
    {
        if (LogWriter.IsVerbose(severity, this.VerbosityLevel))
        {
            lock (this.Lock)
            {
                this.Builder.Append(value);
            }
        }
    }

    public void Write(LogSeverity severity, string format, object arg0)
    {
        if (LogWriter.IsVerbose(severity, this.VerbosityLevel))
        {
            lock (this.Lock)
            {
                this.Builder.AppendFormat(format, arg0);
            }
        }
    }

    public void Write(LogSeverity severity, string format, object arg0, object arg1)
    {
        if (LogWriter.IsVerbose(severity, this.VerbosityLevel))
        {
            lock (this.Lock)
            {
                this.Builder.AppendFormat(format, arg0, arg1);
            }
        }
    }

    public void Write(LogSeverity severity, string format, object arg0, object arg1, object arg2)
    {
        if (LogWriter.IsVerbose(severity, this.VerbosityLevel))
        {
            lock (this.Lock)
            {
                this.Builder.AppendFormat(format, arg0, arg1, arg2);
            }
        }
    }

    public void Write(LogSeverity severity, string format, params object[] args)
    {
        if (LogWriter.IsVerbose(severity, this.VerbosityLevel))
        {
            lock (this.Lock)
            {
                this.Builder.AppendFormat(format, args);
            }
        }
    }

    public void WriteLine(string value) =&gt; this.WriteLine(LogSeverity.Info, value);
    public void WriteLine(string format, object arg0) =&gt;
        this.WriteLine(LogSeverity.Info, format, arg0);
    public void WriteLine(string format, object arg0, object arg1) =&gt;
        this.WriteLine(LogSeverity.Info, format, arg0, arg1);
    public void WriteLine(string format, object arg0, object arg1, object arg2) =&gt;
        this.WriteLine(LogSeverity.Info, format, arg0, arg1, arg2);
    public void WriteLine(string format, params object[] args) =&gt;
        this.WriteLine(LogSeverity.Info, string.Format(format, args));

    public void WriteLine(LogSeverity severity, string value)
    {
        if (LogWriter.IsVerbose(severity, this.VerbosityLevel))
        {
            lock (this.Lock)
            {
                this.Builder.AppendLine(value);
            }
        }
    }

    public void WriteLine(LogSeverity severity, string format, object arg0)
    {
        if (LogWriter.IsVerbose(severity, this.VerbosityLevel))
        {
            lock (this.Lock)
            {
                this.Builder.AppendFormat(format, arg0);
                this.Builder.AppendLine();
            }
        }
    }

    public void WriteLine(LogSeverity severity, string format, object arg0, object arg1)
    {
        if (LogWriter.IsVerbose(severity, this.VerbosityLevel))
        {
            lock (this.Lock)
            {
                this.Builder.AppendFormat(format, arg0, arg1);
                this.Builder.AppendLine();
            }
        }
    }

    public void WriteLine(LogSeverity severity, string format, object arg0, object arg1, object arg2)
    {
        if (LogWriter.IsVerbose(severity, this.VerbosityLevel))
        {
            lock (this.Lock)
            {
                this.Builder.AppendFormat(format, arg0, arg1, arg2);
                this.Builder.AppendLine();
            }
        }
    }

    public void WriteLine(LogSeverity severity, string format, params object[] args)
    {
        if (LogWriter.IsVerbose(severity, this.VerbosityLevel))
        {
            lock (this.Lock)
            {
                this.Builder.AppendFormat(format, args);
                this.Builder.AppendLine();
            }
        }
    }

    public override string ToString()
    {
        lock (this.Lock)
        {
            return this.Builder.ToString();
        }
    }

    public void Dispose()
    {
        lock (this.Lock)
        {
            this.Builder.Clear();
        }
    }
}
</code></pre>
<p>To replace the default logger, call the following <code>IActorRuntime</code> method:</p>
<pre><code class="language-csharp">runtime.Logger = new CustomLogger();
</code></pre>
<p>The above method replaces the previously installed logger with the specified one and returns the
previously installed logger.</p>
<p>Note that the old <code>ILogger</code> might be disposable, so if you care about disposing the old logger at
the same time you may need to write this instead:</p>
<pre><code class="language-csharp">using (var oldLogger = runtime.Logger)
{
   runtime.Logger = new CustomLogger();
}
</code></pre>
<p>You could write a custom <code>ILogger</code> to intercept all logging messages and send them to your favorite
logging service in Azure or even over a TCP socket.</p>
<p>You can also use one of the built-in loggers available in the <code>Microsoft.Coyote.Logging</code> namespace,
such as the <code>MemoryLogger</code> which is a thread-safe logger that writes the log in memory (you can
access it as a <code>string</code> by invoking <code>MemoryLogger.ToString()</code>) or the <code>TextWriterLogger</code> which
allows you to run an existing <code>System.IO.TextWriter</code> into an <code>ILogger</code> implementation.</p>
<h2 id="adding-custom-actor-logging-consumers">Adding custom actor logging consumers</h2>
<p>The <code>IActorRuntime</code> also provides a logging interface called <code>IActorRuntimeLog</code> that allows
consuming <code>Actor</code> and <code>StateMachine</code> activity and processing it in some custom way. When executing
actors, the runtime will call the <code>IActorRuntimeLog</code> interface to log various actions such as a new
<code>Actor</code> or <code>StateMachine</code> getting created or sending an <code>Event</code> to some actor.</p>
<p>You can implement your own <code>IActorRuntimeLog</code> consumer like this:</p>
<pre><code class="language-csharp">internal class CustomRuntimeLog : IActorRuntimeLog
{
  public void OnCreateActor(ActorId id, ActorId creator)
  {
    // Add some custom logic.
  }

  public void OnEnqueueEvent(ActorId id, Event e)
  {
    // Add some custom logic.
  }

  // You can optionally override more actor logging methods.
}
</code></pre>
<p>You can then register the <code>CustomRuntimeLog</code> using the following <code>IActorRuntime</code> method:</p>
<pre><code class="language-csharp">runtime.RegisterLog(new CustomRuntimeLog());
</code></pre>
<p>You can register multiple <code>IActorRuntimeLog</code> objects in case you have consumers that are doing very
different things. The runtime will invoke each callback for every registered <code>IActorRuntimeLog</code>.</p>
<p>For example, see the <code>ActorRuntimeLogGraphBuilder</code> class which implements <code>IActorRuntimeLog</code> and
generates a directed graph representing all activities that happened during the execution of your
actors. See <a href="../../../how-to/coverage/">activity coverage</a> for an example graph output. The <code>coyote</code>
test tool sets this up for you when you specify <code>--actor-graph</code> or <code>--coverage activity</code> command
line options.</p>
<p>See <a href="../../../ref/Microsoft.Coyote.Actors/IActorRuntimeLog/">IActorRuntimeLog API documentation</a>.</p>
<h2 id="customizing-the-text-formatting-when-logging-actor-activities">Customizing the text formatting when logging actor activities</h2>
<p>You can also use the same <code>IActorRuntimeLog</code> feature to customize the text formatting when the
installed <code>ILogger</code> logs actor activity.</p>
<p>The default actor text formatting implementation is provided by the <code>ActorRuntimeLogTextFormatter</code>
base class which implements the <code>IActorRuntimeLog</code> interface and is responsible for formatting all
<code>Actor</code> and <code>StateMachine</code> activity as text and logging it using the installed <code>Logger</code>.</p>
<p>You can add your own subclass of <code>ActorRuntimeLogTextFormatter</code> using the <code>RegisterLog</code> method on
<code>IActorRuntime</code>. However, unlike other <code>IActorRuntimeLog</code> consumers, only a single
<code>ActorRuntimeLogTextFormatter</code> can exist and adding a new one will replace the previous text
formatter.</p>
<p>The following is an example of how to do this:</p>
<pre><code class="language-csharp">internal class CustomActorRuntimeLogTextFormatter : ActorRuntimeLogTextFormatter
{
  public override void OnCreateActor(ActorId id, ActorId creator)
  {
    // Override to change the text to be logged.
    this.Logger.WriteLine(&quot;Hello!&quot;);
  }

  public override void OnEnqueueEvent(ActorId id, Event e)
  {
    // Override to conditionally hide certain events from the log.
    if (!(e is SecretEvent))
    {
      base.OnEnqueueEvent(id, e);
    }
  }

  // You can optionally override more text formatting methods.
}
</code></pre>
<p>You can then replace the default <code>ActorRuntimeLogTextFormatter</code> with your new implementation using
the following <code>IActorRuntime</code> method:</p>
<pre><code class="language-csharp">runtime.RegisterLog(new CustomActorRuntimeLogTextFormatter());
</code></pre>
<p>The above method replaces the previously installed <code>ActorRuntimeLogTextFormatter</code> with the specified
one.</p>
<p>See <a href="../../../ref/Microsoft.Coyote.Actors/ActorRuntimeLogTextFormatter/">ActorRuntimeLogTextFormatter</a>
documentation.</p>

    <br>
      

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../state-machine-demo/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../state-machine-demo/" class="btn btn-xs btn-link">
        State machine demo
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../sharing-objects/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../sharing-objects/" class="btn btn-xs btn-link">
        Sharing objects
      </a>
    </div>
    
  </div>

      <br>
  </div>
</div>

<footer class="wm-page-content">
  

<section class="footer-join pt-40 pb-80">
  <div class="container-fluid">
    <div class="row text-center">
      <div class="col-sm-8 col-sm-offset-2">
      </div>
    </div>
    <div class="row">
   </div>
  </div>
</section>
<section class="footer-dark pt-60">
  <div class="container-fluid">
    <div class="row">
      <div class="hidden-xs col-sm-5 col-lg-6">
        <a href="" title="homepage" class="logo-footer">
          <img src="/coyote/assets/images/icon.png" alt="Coyote">
        </a>
      </div>

      <div class="col-sm-2 col-xs-4 footer-dark-col">
        <nav>
          <h4>Coyote</h4>
          <ul class="list-unstyled">
            <li><a href="/coyote/">Home</a></li>
            <li><a href="/coyote/get-started/install/">Install</a></li>
            <li><a href="https://github.com/microsoft/coyote/"><i class="fa fa-github"></i>
GitHub</a></li>
          </ul>
        </nav>
      </div>

      <div class="col-sm-2 col-xs-4 footer-dark-col">
        <nav>
          <h4>Resources</h4>
          <ul class="list-unstyled">
            <li><a href="/coyote/tutorials/first-concurrency-unit-test/">Getting started</a></li>
            <li><a href="/coyote/tutorials/overview/">Tutorials</a></li>
            <li><a href="/coyote/ref/Microsoft.Coyote">API documentation</a></li>
          </ul>
        </nav>
      </div>

      <div class="col-sm-2 col-xs-4 footer-dark-col">
        <nav>
          <h4>Community</h4>
          <ul class="list-unstyled">
            <li><a href="https://github.com/microsoft/coyote/discussions"><i class="fa fa-github"></i>
GitHub</a></li>
            <li><a href="https://twitter.com/coyote_dev" target="_blank"><i class="fa fa-twitter"></i> Twitter</a></li>
            <li><a href="https://teams.microsoft.com/l/channel/19%3a1fe966b4fdc544bca648d89bf25c3c56%40thread.tacv2/General?groupId=7a6d8afc-c23d-4e5d-b9cb-9124118c0220&tenantId=72f988bf-86f1-41af-91ab-2d7cd011db47" target="_blank">Teams (Internal)</a></li>
          </ul>
        </nav>
      </div>
    </div>

    <div class="row footnote pt-50 pb-20">
      <div class="col-sm-12">
        <hr>
      </div>
      <div class="col-sm-7">
        <ul class="list-unstyled list-inline footnote-copy">
          <li><a href="https://go.microsoft.com/fwlink/?LinkId=521839" target="_blank">Privacy & Cookies</a></li>
          <li><a href="https://go.microsoft.com/fwlink/?linkid=2259814" target="_blank">Consumer Health Privacy</a></li>
          <li><a href="https://go.microsoft.com/fwlink/?LinkID=206977" target="_blank">Terms of Use</a></li>
          <li><a href="https://www.microsoft.com/en-us/legal/intellectualproperty/trademarks" target="_blank">Trademarks</a></li>
          <li><a href="https://github.com/microsoft/coyote/blob/main/LICENSE" target="_blank">License</a></li>
        </ul>
      </div>
      <div class="col-sm-5 text-right footnote-copy">
        <ul class="list-unstyled list-inline">
          <li><span id="copyright"></span></li>
          <li><a href="https://www.microsoft.com/" target="_blank"><img class="img-responsive" src="/coyote/assets/images/microsoft-logo.svg?v=3" alt="Microsoft">&nbsp;</a></li>
        </ul>
      </div>
    </div>
  </div>
</section>
</footer>


<script type="text/javascript">
    $(document).ready(function () {
      $('table').each(function () {
        $(this).addClass("table");
        $(this).addClass("table-bordered");
        $(this).addClass("table-striped");
        $(this).addClass("table-condensed");
      });

    });
</script>

</body>
</html>